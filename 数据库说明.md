# 🗄️ YXLP数据库说明

## 📊 数据库概述

YXLP项目使用 **SQLite** 数据库，这是一个轻量级的文件数据库，非常适合开发和小型部署。

### 🎯 为什么选择SQLite？

- ✅ **零配置**：无需安装数据库服务器
- ✅ **轻量级**：单个文件，易于备份和迁移
- ✅ **高性能**：对于中小型应用性能优秀
- ✅ **跨平台**：支持所有操作系统
- ✅ **ACID兼容**：支持事务和数据完整性

## 📁 数据库文件位置

```
apps/api/data/yxlp.db    # 主数据库文件
apps/web/data/           # 前端相关数据文件
├── ai-config.json       # AI配置
└── crawl-progress.json  # 采集进度
```

## 🏗️ 数据库结构

### 核心表结构

1. **users** - 用户表
   - 用户认证信息
   - 角色权限管理
   - 用户资料

2. **rss_sources** - RSS源表
   - 新闻源配置
   - 多语言支持
   - 质量评分

3. **news_articles** - 新闻文章表
   - 文章内容
   - AI处理状态
   - SEO优化信息

4. **crawl_jobs** - 采集任务表
   - 任务状态跟踪
   - 进度监控

5. **seo_keywords** - SEO关键词表
   - 多语言关键词
   - 搜索引擎优化

## 🚀 自动初始化

### 首次启动时

项目会自动：
1. **创建数据目录**：`apps/api/data/`
2. **创建数据库文件**：`yxlp.db`
3. **初始化表结构**：所有必需的表和索引
4. **插入初始数据**：管理员账号、RSS源等

### 初始数据包含

- 👤 **默认管理员**：admin / admin123
- 📰 **RSS源**：13种语言的新闻源
- 🔍 **SEO关键词**：Google和百度关键词库
- ⚙️ **系统配置**：基础配置项

## 🔧 数据库管理

### 查看数据库
```bash
# 使用SQLite命令行工具
sqlite3 apps/api/data/yxlp.db

# 查看所有表
.tables

# 查看表结构
.schema users

# 查看数据
SELECT * FROM users LIMIT 5;
```

### 备份数据库
```bash
# 简单备份（复制文件）
cp apps/api/data/yxlp.db backup/yxlp-backup-$(date +%Y%m%d).db

# 导出SQL
sqlite3 apps/api/data/yxlp.db .dump > backup/yxlp-backup.sql
```

### 重置数据库
```bash
# 删除数据库文件，重启会自动重建
rm apps/api/data/yxlp.db
npm run dev
```

## 📈 生产环境建议

### 数据库升级路径

1. **小型部署**：继续使用SQLite
2. **中型部署**：升级到PostgreSQL
3. **大型部署**：考虑分布式数据库

### 性能优化

- ✅ 已启用WAL模式提高并发性能
- ✅ 已创建必要的索引
- ✅ 已优化查询语句
- ✅ 支持连接池

## 🔒 数据安全

### 备份策略
- 📅 **每日备份**：自动备份数据库文件
- 🔄 **版本控制**：保留多个备份版本
- ☁️ **云存储**：备份到云端存储

### 访问控制
- 🔐 **文件权限**：限制数据库文件访问
- 🛡️ **应用层认证**：JWT token验证
- 🔍 **审计日志**：记录数据库操作

## 🛠️ 开发工具

### 推荐工具
- **DB Browser for SQLite**：图形化管理工具
- **SQLite Studio**：功能丰富的管理器
- **VS Code SQLite扩展**：编辑器内查看

### 调试技巧
```bash
# 启用SQL日志
NODE_ENV=development npm run dev

# 查看慢查询
PRAGMA compile_options;

# 分析查询计划
EXPLAIN QUERY PLAN SELECT * FROM users;
```

## ❓ 常见问题

### Q: 数据库文件丢失了怎么办？
A: 重启应用会自动重建，但数据会丢失。建议定期备份。

### Q: 如何迁移到PostgreSQL？
A: 使用TypeORM的迁移功能，修改配置即可。

### Q: 数据库文件过大怎么办？
A: 运行 `VACUUM` 命令压缩，或考虑数据归档。

### Q: 多个开发者如何共享数据？
A: 可以提交示例数据库到Git，或使用数据库种子脚本。

---

**💡 提示：数据库会在首次启动时自动创建，无需手动操作！**
